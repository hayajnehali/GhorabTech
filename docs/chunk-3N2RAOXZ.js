import{d as P}from"./chunk-AUOFYUHM.js";import{ab as k,b as O,c as j,f as H,k as l,n as N,p as V,q as D,r as z,x as A}from"./chunk-IHEU7YP6.js";import{$a as _,Bc as T,Gc as E,Hc as M,Ob as m,Pb as o,Qb as r,Rb as x,Wa as s,X as C,Y as b,Yb as w,aa as F,ba as g,bc as f,dc as h,ga as y,ha as S,hb as d,nb as I,rc as v,sb as u,sc as U}from"./chunk-B6JOQ4YJ.js";var p=class a{constructor(e){this.http=e}baseUrl=N.apiUrl+"FileUpload";uploadFile(e){return this.http.post(this.baseUrl,e)}getFiles(){return this.http.get(`${this.baseUrl}/files`)}static \u0275fac=function(i){return new(i||a)(F(l))};static \u0275prov=b({token:a,factory:a.\u0275fac,providedIn:"root"})};function B(a,e){if(a&1){let i=w();o(0,"div",6)(1,"div",7),x(2,"app-image",8),o(3,"button",9),f("click",function(){let t=y(i).index,c=h(2);return S(c.removeImage(t))}),v(4," \u2715 "),r()()()}if(a&2){let i=e.$implicit;s(2),m("src",i.guidName)}}function G(a,e){if(a&1&&(o(0,"div",4),u(1,B,5,1,"div",5),r()),a&2){let i=h();s(),m("ngForOf",i.images)}}var R=class a{constructor(e,i){this.http=e;this.fileUploadService=i}images=[];imagesChange=new _;maxFiles=4;maxFileSize=3*1024*1024;allowedTypes=["image/jpeg","image/png","image/gif","image/webp","image/jpg","image/svg","image/svg+xml"];selectedFiles=[];translateService=g(V);notificationService=g(k);onChange=()=>{};onTouched=()=>{};writeValue(e){this.images=e||[]}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}updateImages(e){this.images=e,this.onChange(this.images),this.onTouched()}removeImage(e){this.images.splice(e,1),this.onChange(this.images)}onFilesSelected(e){let i=e.target.files;if(i.length+this.images.length>this.maxFiles){this.notificationService.showWarning(this.translateService.instant("upload.maxFiles",{count:this.maxFiles}));return}for(let t of i){if(!this.allowedTypes.includes(t.type)){this.notificationService.showWarning(this.translateService.instant("upload.invalidType",{name:t.name}));return}if(t.size>this.maxFileSize){this.notificationService.showWarning(this.translateService.instant("upload.maxSize",{name:t.name,size:2}));return}}this.selectedFiles=Array.from(i);let n=new FormData;this.selectedFiles.forEach(t=>{n.append("files",t,t.name)}),this.fileUploadService.uploadFile(n).subscribe({next:t=>{this.images=[...this.images,...t],this.onChange(this.images),this.onTouched(),this.imagesChange.emit(this.images)},error:t=>console.error("File upload failed:",t)})}static \u0275fac=function(i){return new(i||a)(d(l),d(p))};static \u0275cmp=I({type:a,selectors:[["app-multi-image-upload"]],inputs:{images:"images"},outputs:{imagesChange:"imagesChange"},features:[T([{provide:A,useExisting:C(()=>a),multi:!0}])],decls:6,vars:4,consts:[[1,"form-group"],["for","images"],["type","file","id","images","accept","image/*","name","image","multiple","",1,"form-control",3,"change"],["class","row w-100 mt-3 thumbnail-gallery",4,"ngIf"],[1,"row","w-100","mt-3","thumbnail-gallery"],["class","col-2 p-1",4,"ngFor","ngForOf"],[1,"col-2","p-1"],[1,"thumbnail-wrapper"],["alt","Uploaded Image",1,"thumb-img",3,"src"],["type","button",1,"btn","btn-sm","btn-danger","remove-btn",3,"click"]],template:function(i,n){i&1&&(o(0,"div",0)(1,"label",1),v(2),E(3,"translate"),r(),o(4,"input",2),f("change",function(c){return n.onFilesSelected(c)}),r(),u(5,G,2,1,"div",3),r()),i&2&&(s(2),U(M(3,2,"general.upload-images")),s(3),m("ngIf",n.images.length>0))},dependencies:[z,H,O,j,P,D],encapsulation:2})};export{R as a};
