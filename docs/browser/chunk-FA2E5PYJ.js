import{a as h}from"./chunk-PLKS45W7.js";import{b as d}from"./chunk-35YHXOGJ.js";import{_a as C,cb as y,k as p,n as m}from"./chunk-IHEU7YP6.js";import{Y as l,aa as u,g as n}from"./chunk-B6JOQ4YJ.js";var o=class extends d{userId;expiresAt=new Date;cartItems=[];currency="usd";orderExitStatus;recipientInfo=new c;payWay};var f=class extends C{paymentStatus;orderExitStatus;payWay},c=class{fullName="";phoneNumber="";addressLine="";city;stateOrProvince;postalCode;country;notes=""};var b=class s extends y{constructor(t,e){super(e,"cart");this.storage=t}CART_KEY=m.CART_KEY;cartTotal=new n(0);cartTotal$=this.cartTotal.asObservable();cartSubject=new n(new o);cart$=this.cartSubject.asObservable();initCart(){this.getTotal()}getCart(){let t=this.storage.get(this.CART_KEY);if(t)return this.saveCart(t),t;let e=new o;return e.id=this.generateCartId(),this.saveCart(e),e}saveCart(t){t.updateStamp=new Date,this.storage.set(this.CART_KEY,t);let e=this.calculationTotal(t)}addItem(t){let e=this.getCart(),r=e.cartItems.find(a=>a.product.id===t.product.id&&this.hasSameKeyAttributes(a.keyAttributeValues,t.keyAttributeValues));r?r.quantity+=t.quantity:(e.cartItems||(e.cartItems=[]),e.cartItems.push(t)),this.saveCart(e)}decreaseQuantity(t){this.updateQuantity(t,-1)}increaseQuantity(t){this.updateQuantity(t,1)}updateQuantity(t,e){let r=this.getCart(),a=r.cartItems.find(i=>i.product.id===t.product.id&&this.hasSameKeyAttributes(i.keyAttributeValues,t.keyAttributeValues));a&&(a.quantity=a.quantity+e,a.quantity==0&&(r.cartItems=r.cartItems.filter(i=>i.id!==t.product.id&&!this.hasSameKeyAttributes(i.keyAttributeValues,t.keyAttributeValues))),this.saveCart(r))}removeItem(t){let e=this.getCart();e.cartItems=e.cartItems.filter(r=>r.id!==t),this.saveCart(e)}clearCart(){this.cartSubject.next(new o),this.cartTotal.next(0),this.storage.remove(this.CART_KEY)}getTotal(){let t=this.getCart();return this.calculationTotal(t)}calculationTotal(t){let e=t.cartItems.reduce((r,a)=>r+(a.product.price??0)*a.quantity,0);return this.cartTotal.next(e),this.cartSubject.next(t),e}generateCartId(){return crypto.randomUUID()}changeOrderExitStatusOfCart(t,e){return this.http.put(`${this.baseUrl}/change-order-exit-status-cart/${t}?orderExitStatus=${e}`,{})}hasSameKeyAttributes(t,e){if(t.length!==e.length)return!1;let r=t.map(i=>i.id).sort(),a=e.map(i=>i.id).sort();return r.every((i,v)=>i===a[v])}createAndPay(t){return this.http.post(this.baseUrl+"/create-and-pay",t)}getCartsByUser(t){let e=this.buildHttpParams(t);return this.http.get(this.baseUrl+"/get-cart-by-user",{params:e})}static \u0275fac=function(e){return new(e||s)(u(h),u(p))};static \u0275prov=l({token:s,factory:s.\u0275fac,providedIn:"root"})};export{o as a,f as b,c,b as d};
